<?xml version="1.0" encoding="utf-8"?>

<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"  
   	creationComplete="initApp()">
	
	<mx:Script>
		<![CDATA[
            import com.universalmind.hStore.model.vo.Cart;
			import com.universalmind.hStore.model.vo.Item;

			import mx.utils.ObjectUtil;
			import mx.rpc.AsyncToken;
			import mx.controls.Alert;
			import mx.collections.ArrayCollection;

			import mx.messaging.Channel;
			import mx.messaging.ChannelSet;
			import mx.messaging.channels.AMFChannel;

			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			

			
			private var _flexChannelSet:ChannelSet;
			
			private function initApp():void
			{
				var _flexChannel:Channel = new AMFChannel("my-amf", "http://localhost:8080/andiPowellApp2/messagebroker/amf");			
					_flexChannelSet = new ChannelSet();
					_flexChannelSet.addChannel(_flexChannel);
					
				storeService.channelSet = _flexChannelSet;	
			}

			[Bindable] public var carts:ArrayCollection = new ArrayCollection();

			public function onResult(event:ResultEvent):void
			{
				if( event.token.operation == "getCarts" )
				{
					carts = event.result as ArrayCollection;
				}				
			}
			
			public function onFault(event:FaultEvent):void
			{
				Alert.show(event.fault.faultString, "Error");
			}
			
			
			private function doResetDb():void
			{
				var token:AsyncToken = storeService.resetDb();
					token.operation = "doResetDb";					
			}
			
			
			private function doGetAllItems():void
			{
				var token:AsyncToken = storeService.getAllCarts();
					token.operation = "getCarts";					
			}
			
			private function saveItem(item:Item):void{
				storeService.saveItem(item);
			}
			
			private function saveCart(cart:Cart):void{
				var token:AsyncToken = storeService.saveCart(cart);
					token.operation = "saveCart";
			}
			
			
		]]>
	</mx:Script>
	

	<dp:HibernateRemoteObject
		id="storeService"
		destination="storeService"
	    showBusyCursor="true" 
		result="onResult(event)" fault="onFault(event)"
		xmlns:dp="http://www.digitalprimates.net/2007/mxml">
	</dp:HibernateRemoteObject>

	<mx:HBox width="100%" horizontalAlign="left">		
		<mx:Button
			label="ResetDB"
			click="doResetDb()"/>	
		<mx:Button
			label="Load/Refresh"
			click="doGetAllItems()"/>	
	</mx:HBox>
	
	<mx:DataGrid
		id="cartList"
		dataProvider="{carts}"
		width="100%">		
		<mx:columns>
				<mx:DataGridColumn headerText="orderID" dataField="orderID"/>
				<mx:DataGridColumn headerText="total" dataField="total"/>
		</mx:columns>
	</mx:DataGrid>
	
	<mx:DataGrid
		id="itemList"
		dataProvider="{cartList.selectedItem.items}"
		width="100%">		
		<mx:columns>
				<mx:DataGridColumn headerText="name" dataField="name"/>
				<mx:DataGridColumn headerText="sku" dataField="sku"/>
		</mx:columns>
	</mx:DataGrid>
	
	
</mx:Application>


